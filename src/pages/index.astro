---
// src/pages/index.astro
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <title>Reto Flexiones 2026</title>
  </head>
  <body>
    <main>
      <header class="hero">
        <h1>Reto de Flexiones <span class="accent">2026</span></h1>

        <div
          class="progress-section"
          id="progress-container"
          style="display: none;"
        >
          <div class="progress-labels">
            <span>Progreso Anual</span>
            <span class="progress-text" id="progress-text">0/365</span>
          </div>
          <div class="progress-track">
            <div class="progress-fill" id="progress-fill" style="width: 0%;">
            </div>
          </div>
        </div>

        <div
          class="stats"
          id="stats-container"
          style="opacity: 0; transition: opacity 0.5s;"
        >
          <div class="stat-box">
            <span class="label">Total Acumulado</span>
            <span class="value" id="stat-total">-</span>
          </div>
        </div>
      </header>

      <section class="grid" id="video-grid">
        <div class="loading">Cargando videos...</div>
      </section>
    </main>

    <script is:inline>
      // ------------------------------------------------------
      // 1. PEGA AQUÍ TU URL DE GOOGLE SHEETS (CSV)
      const SHEET_URL =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vSi5taqFE6-_lgB2ds-962Dga1nvfQcez6XjQzK-tfA1M0yWDfz9Pe9e0Q4sBiNlO3EZVWz33tevfoq/pub?output=csv";

      // 2. FECHA DE INICIO DEL RETO (Año, Mes-1, Día)
      const START_DATE = new Date(2026, 0, 1);
      // ------------------------------------------------------

      const GOAL_DAYS = 365;

      function formatDate(date) {
        return date.toLocaleDateString("es-AR", {
          day: "2-digit",
          month: "2-digit",
          year: "numeric",
        });
      }

      function createCard(video) {
        return `
          <article class="card fade-in">
            <div class="video-container">
              <iframe
                src="https://www.youtube.com/embed/${video.videoId}"
                title="Día ${video.day}"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                allowfullscreen
                loading="lazy" 
              ></iframe>
            </div>
            <div class="info-minimal">
              <span class="badge">Día ${video.day}</span>
              <span class="date">${video.dateStr}</span>
            </div>
          </article>
        `;
      }

      async function loadVideos() {
        try {
          const response = await fetch(SHEET_URL);
          const data = await response.text();

          const rows = data
            .split(/\r?\n/)
            .map((row) => row.trim())
            .filter((row) => row.length > 0);

          if (rows.length === 0) throw new Error("No hay videos");

          const videos = rows
            .map((id, index) => {
              const dayNumber = index + 1;
              const videoDate = new Date(START_DATE);
              videoDate.setDate(START_DATE.getDate() + index);

              return {
                videoId: id,
                day: dayNumber,
                count: dayNumber,
                dateStr: formatDate(videoDate),
              };
            })
            .reverse();

          // --- Actualizar Interfaz ---

          const currentDay = videos.length;
          const totalPushups = videos.reduce(
            (acc, curr) => acc + curr.count,
            0
          );
          const percent = Math.min((currentDay / GOAL_DAYS) * 100, 100).toFixed(
            1
          );

          document.getElementById("stat-total").innerText =
            totalPushups.toLocaleString();
          document.getElementById("stats-container").style.opacity = 1;

          // CAMBIO AQUÍ: Formato "Día actual/365"
          document.getElementById("progress-text").innerText =
            `Día ${currentDay}/${GOAL_DAYS}`;

          document.getElementById("progress-fill").style.width = `${percent}%`;
          document.getElementById("progress-container").style.display = "block";

          const grid = document.getElementById("video-grid");
          grid.innerHTML = videos.map(createCard).join("");
        } catch (error) {
          console.error(error);
          document.getElementById("video-grid").innerHTML =
            '<p style="text-align:center; color:#ff6b6b">Error al cargar la lista de videos.</p>';
        }
      }

      loadVideos();
    </script>
  </body>
</html>

<style is:global>
  /* --- Estilos Globales --- */
  body {
    font-family:
      system-ui,
      -apple-system,
      sans-serif;
    background-color: #0a0a0a;
    color: #ffffff;
    margin: 0;
    padding: 0;
  }

  main {
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
  }

  /* --- Hero --- */
  .hero {
    text-align: center;
    margin-bottom: 3rem;
  }

  h1 {
    font-size: 2.5rem;
    margin-bottom: 1.5rem;
    font-weight: 800;
  }

  .accent {
    color: #8b5cf6;
  }

  /* --- Barra de Progreso --- */
  .progress-section {
    max-width: 500px;
    margin: 0 auto 2rem auto;
    background: #171717;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    border: 1px solid #333;
  }

  .progress-labels {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
    font-size: 0.85rem;
    color: #a1a1aa;
  }

  .progress-text {
    color: #fff;
    font-weight: bold;
  }

  .progress-track {
    width: 100%;
    height: 8px;
    background: #333;
    border-radius: 10px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: #8b5cf6;
    border-radius: 10px;
    transition: width 1s ease;
  }

  /* --- Estadísticas --- */
  .stats {
    display: flex;
    justify-content: center;
  }

  .stat-box {
    text-align: center;
  }

  .stat-box .label {
    display: block;
    font-size: 0.8rem;
    color: #888;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 0.2rem;
  }

  .stat-box .value {
    font-size: 3rem;
    font-weight: 800;
    color: #fff;
    line-height: 1;
  }

  /* --- Grid --- */
  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
  }

  .loading {
    text-align: center;
    width: 100%;
    color: #666;
    grid-column: 1 / -1;
  }

  /* --- Card Minimalista --- */
  .card {
    background: #171717;
    border-radius: 8px;
    overflow: hidden;
    border: 1px solid #262626;
    transition:
      transform 0.2s,
      border-color 0.2s;
  }

  .card:hover {
    transform: translateY(-3px);
    border-color: #8b5cf6;
  }

  .video-container {
    position: relative;
    padding-bottom: 56.25%;
    background: black;
  }

  .video-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
  }

  .info-minimal {
    padding: 1rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #171717;
  }

  .badge {
    background: #333;
    color: #fff;
    padding: 0.2rem 0.6rem;
    border-radius: 4px;
    font-size: 0.85rem;
    font-weight: 600;
  }

  .date {
    color: #666;
    font-size: 0.85rem;
    font-family: monospace;
  }

  /* Animación */
  .fade-in {
    animation: fadeIn 0.6s ease-out;
  }
  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
